<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>事件下拉選單預覽</title>
<style>
  :root{
    --bg:#0b1322; --card:#0f1a2d; --card-border:#1b2a44; --text:#e2e8f0; --shadow:0 8px 18px rgba(0,0,0,.35);
  }
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.55 ui-sans-serif,system-ui;}
  .card{background:var(--card);border:1px solid var(--card-border);border-radius:18px;box-shadow:var(--shadow);padding:18px;margin:16px auto;max-width:900px}
  h2{margin:0 0 12px}
  #controls{display:flex;gap:.5rem;align-items:center}
  #controls button,#controls select{
    background:#0e223a;color:var(--text);border:1px solid var(--card-border);
    border-radius:10px;padding:8px 12px;cursor:pointer;
  }
  label{display:flex;align-items:center;gap:8px}

  /* 客製事件下拉 */
  #eventWrap{ position:relative; display:flex; align-items:center; gap:8px; }
  .select-trigger{
    background:#0e223a; color:var(--text);
    border:1px solid var(--card-border);
    border-radius:8px; padding:6px 10px; cursor:pointer;
  }
  .select-menu{
    position:absolute; top:100%; left:0; z-index:20;
    width:120px;
    background:#0e223a; color:var(--text);
    border:1px solid var(--card-border); border-radius:10px;
    box-shadow:var(--shadow);
    max-height: 280px; /* 約 10 筆 */
    overflow-y: auto;
  }
  .select-menu .opt{
    padding:8px 12px; cursor:pointer; white-space:nowrap;
  }
  .select-menu .opt:hover,
  .select-menu .opt.active{
    background: rgba(20,184,166,.18);
  }

  /* 假的顯示區 */
  #now{margin-top:16px;opacity:.85}
</style>
</head>
<body>
  <section class="card">
    <h2>記分板（預覽）</h2>

    <div id="controls">
      <button>⏮ 上一步</button>
      <button>▶️ 播放</button>
      <button>⏭ 下一步</button>

      <label>速度
        <select>
          <option>慢</option>
          <option selected>中</option>
          <option>快</option>
        </select>
      </label>

      <!-- 這就是要預覽的事件選單 -->
      <label id="eventWrap">事件
        <button id="eventBtn" class="select-trigger" type="button">—</button>
        <select id="eventSelect" hidden></select>
        <div id="eventMenu" class="select-menu" hidden></div>
      </label>

      <span id="evtCounter" style="margin-left:auto;opacity:.75">事件：0 / 0</span>
    </div>

    <div id="now">現在事件：—</div>
  </section>

<script>
  // 假資料：35 個事件
  const frames = Array.from({length:35}, (_,i)=>({i, label:`事件 ${i+1}`}));
  let current = -1;

  // 建立事件選單（原生 select + 客製 menu）
  function renderEventSelect(currentIdx){
    const sel  = document.getElementById('eventSelect');
    const menu = document.getElementById('eventMenu');
    const btn  = document.getElementById('eventBtn');
    if (!sel || !menu || !btn) return;

    // 原生 select（隱藏備援）
    sel.replaceChildren(...frames.map((_,i)=>{
      const o=document.createElement('option');
      o.value=String(i); o.textContent=String(i+1);
      return o;
    }));

    // 客製清單
    const frag = document.createDocumentFragment();
    frames.forEach((_,i)=>{
      const item = document.createElement('div');
      item.className = 'opt';
      item.textContent = String(i+1);
      item.dataset.value = String(i);
      item.onclick = () => { closeEventMenu(); showStep(i); };
      frag.appendChild(item);
    });
    menu.replaceChildren(frag);

    highlightEventMenu(currentIdx);
    btn.textContent = (currentIdx >= 0) ? String(currentIdx + 1) : '—';
    document.getElementById('evtCounter').textContent = `事件：${Math.max(0,currentIdx+1)} / ${frames.length}`;
  }

  function highlightEventMenu(idx){
    const menu = document.getElementById('eventMenu');
    if (!menu) return;
    const items = menu.querySelectorAll('.opt');
    items.forEach((el, i) => el.classList.toggle('active', i === idx));
    if (idx >= 0 && idx < items.length) items[idx].scrollIntoView({ block:'nearest' });
  }

  function toggleEventMenu(){
    const menu = document.getElementById('eventMenu');
    if (!menu) return;
    menu.hidden = !menu.hidden;
    if (!menu.hidden) {
      const active = menu.querySelector('.opt.active');
      if (active) active.scrollIntoView({ block:'nearest' });
    }
  }
  function closeEventMenu(){
    const menu = document.getElementById('eventMenu');
    if (menu) menu.hidden = true;
  }

  function showStep(idx){
    if (idx < 0 || idx >= frames.length) return;
    current = idx;
    document.getElementById('now').textContent = `現在事件：#${idx+1}`;
    document.getElementById('eventBtn').textContent = String(idx+1);

    // 同步客製高亮
    highlightEventMenu(idx);

    // 同步隱藏 select 的值（備援用途）
    const sel = document.getElementById('eventSelect');
    if (sel && sel.value !== String(idx)) sel.value = String(idx);
  }

  // 綁定
  document.getElementById('eventBtn').addEventListener('click', toggleEventMenu);
  document.addEventListener('click', (e)=>{
    const wrap = document.getElementById('eventWrap');
    if (wrap && !wrap.contains(e.target)) closeEventMenu();
  });
  document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeEventMenu(); });

  // 啟動
  renderEventSelect(-1);
</script>
</body>
</html>
